{% extends 'base.html' %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto; padding: 20px;">
    <h2 style="margin-bottom: 20px;">Course Reviews</h2>

    <!-- Conditional Form -->
    {% if request.user.is_authenticated %}
        <div style="background: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 30px;">
            <h3 style="margin-bottom: 15px;">
                {% if user_review %}Edit Your Review{% else %}Write a Review{% endif %}
            </h3>

            <form method="post" action="{% if user_review %}{% url 'reviews:update' user_review.pk %}{% else %}{% url 'reviews:create' %}{% endif %}">
                {% csrf_token %}

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;">Rating:</label>
                    <div style="display: flex; gap: 15px;">
                        {% for value, label in form.rating.field.choices %}
                            <label style="display: flex; align-items: center;">
                                <input type="radio" name="rating" value="{{ value }}"
                                    {% if user_review.rating == value %}checked{% endif %}
                                    style="margin-right: 5px;">
                                {{ label }}
                            </label>
                        {% endfor %}
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;">Review:</label>
                    <textarea name="content" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">{% if user_review %}{{ user_review.content }}{% endif %}</textarea>
                </div>

                <button type="submit" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                    {% if user_review %}Update Review{% else %}Submit Review{% endif %}
                </button>

                {% if user_review %}
                    <a href="{% url 'reviews:delete' user_review.pk %}"
                       style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; text-decoration: none; margin-left: 10px;">
                        Delete
                    </a>
                {% endif %}
            </form>
        </div>
    {% endif %}

    <!-- Reviews List -->
    <div>
        {% for review in reviews %}
            <div style="border-bottom: 1px solid #eee; padding: 15px 0;">
                <div class="review-item" id="review-{{ review.id }}">
                    <!-- Existing review content -->
                    {% include "reviews/partials/vote_controls.html" with review=review user_vote=review.get_user_vote request=request %}
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <strong>{{ review.user.get_full_name|default:review.user.username }}</strong>
                    <span>
                        {% if review.rating == 1 %}⭐
                        {% elif review.rating == 2 %}⭐⭐
                        {% elif review.rating == 3 %}⭐⭐⭐
                        {% elif review.rating == 4 %}⭐⭐⭐⭐
                        {% elif review.rating == 5 %}⭐⭐⭐⭐⭐
                        {% endif %}
                        ({{ review.get_rating_display }})
                    </span>
                </div>
                <p style="margin: 10px 0;">{{ review.content }}</p>
                <div style="color: #666; font-size: 0.9em;">
                    {{ review.created_at|date:"F j, Y" }}
                    {% if review.user == request.user %}
                        · <a href="{% url 'reviews:update' review.pk %}" style="color: #007bff;">Edit</a>
                    {% endif %}
                </div>
            </div>
        {% empty %}
            <p style="color: #666; font-style: italic;">No reviews yet.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
